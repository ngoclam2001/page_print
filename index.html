<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/jquery-3.7.1.min.js"></script>
</head>
<body>
    <div class="container" id="main_content">
        <div class="top_info">
            <div class="img_top">
                <img src="/img_re.png" alt="logo">
            </div>
            <div class="text_center">
                <h1 class="text_top text_uppercase">thông tin quyền sử dụng đất,</h1>
                <h1 class="text_uppercase text_top">quyền sở hữu tài sản liên quan với đất</h1>
                <span class="fs-10">(Thông tin này được lấy từ mã QR in trên Giấy xác nhận)</span>
            </div>
            <div class="text_right fs-10 code_pdf">
                AA 0123456
            </div>
        </div>
        <div class="content">
            <ol class="list_info">
                <li class="text_bold fs-10">
                    Người sử dụng đất, chủ sử dụng tài sản gắn liền với đất:
                </li>
                <div class="list_person">
                    <!-- danh sach nguoi su dung -->
                </div>
                <li class="text_bold">
                    Thông tin thửa đất:
                </li>
                <!-- TH1: Giay chung nhan cap cho mot thua dat -->
                <div class="list_land land_first_case hide">
                    <div class="first_land_info">
                        <p>a. Thừa đất số: <span class="land_number">01</span></p>
                        <p>tờ bản đồ số: <span class="land_map_number">100m2</span></p>    
                    </div>
                    <div class="first_land_info">
                        <p>b. Diện tích: <span class="land_area">cac</span></p>
                        <p>c. Loại đất: <span class="land_class">abc</span></p>
                    </div>
                    <p>d. Thời hạn sử dụng: <span class="land_use-date">abc</span></p>
                    <p>đ. Hình thức sử dụng: <span class="land_use">abc</span></p>
                    <p>e. Địa chỉ: <span class="land_address">abc</span></p>
                    <p>g. Nguồn gốc sử dụng đất: <span class="land_purpose ">abc</span></p>
                </div>
                <!-- TH2: Giay chung nhan cho nhieu thua dat nong nghiep -->
                <div class="list_land land_second_case hide">
                    <div class="first_land_info">
                        <p>a. Thừa đất số: <span class="land_number_s">01</span></p>
                        <p>b. Diện tích: <span class="land_area_s">100m2</span></p>    
                    </div>
                    <p>c. Địa chỉ: <span class="land_address_s">abc</span></p>
                    <div class="table_land">
                        <table>
                            <!-- Bang thong tin -->
                            <tbody class="list_table_land">
                                <tr>
                                    <th>
                                        <p>Tờ bản đồ số</p>
                                    </th>
                                    <th>
                                        <p>Thửa đất số</p>
                                    </th>
                                    <th>
                                        <p>Diện tích(m2)</p>
                                    </th>
                                    <th>
                                        <p>Loại đất</p>
                                    </th>
                                    <th>
                                        <p>Thời hạn sử dụng</p>
                                    </th>
                                    <th>
                                        <p>Hình thức sử dụng</p>
                                    </th>
                                    <th>
                                        <p>Nguồn gốc sử dụng đất</p>
                                    </th>
                                    <th>
                                        <p>Địa chỉ</p>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <li class="text_bold">
                    Thông tin tài sản gắn liền với đất:
                </li>
                <!-- Cac thong tin lien qan -->
                <div class="land_info_asset">
                </div>
                <!-- TH1: Giay chung nhan can ho hoac cong trinh -->
                <div class="first_case_asset">
                    <table class="table_asset_first">
                        <tbody>
                            <tr>
                                <th>
                                    <p>Tên tài sản</p>
                                </th>
                                <th>
                                    <p>Diện tích xây dựng(m2)</p>
                                </th>
                                <th>
                                    <p>Diện tích sử dụng(m2)</p>
                                </th>
                                <th>
                                    <p>Hình thức sở hữu</p>
                                </th>
                                <th>
                                    <p>Cấp công trình</p>
                                </th>
                                <th>
                                    <p>Thời hạn sở hữu</p>
                                </th>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!--TH2: Giay chung nhan can ho -->
                <div class="second_case_asset">
                    <table class="table_asset_second">
                        <tbody>
                            <tr>
                                <th>
                                    <p>Tên tài sản</p>
                                </th>
                                <th>
                                    <p>Diện tích sàn xây dựng(m2)</p>
                                </th>
                                <th>
                                    <p>Diện tích sử dụng(m2)</p>
                                </th>
                                <th>
                                    <p>Hình thức sở hữu</p>
                                </th>
                                <th>
                                    <p>Thời hạn sở hữu</p>
                                </th>
                            </tr>
                        </tbody>
                    </table>
                </div>
          <li class="text_bold" id="page2el">
                    Sơ đồ thửa đất, tài sản gắn liền với đất:
                </li>
                <div class="image_land">
                    
                </div>
            </ol>
        </div>
    </div>
    <div class="btn_docx">
        <button id="downloadBtn">Tạo và tải xuống DOCX</button>
        <button class="btn_print">Tạo và tải xuống PDF</button>
    </div>
</body>
<script>
    $(document).ready(function(){
        function load_muc_1(){
            var data_person = [
            {
                person_name: "Nguyễn Văn A",
                person_cccd: "231414141"
            },
            {
                person_name: "Nguyễn Văn B",
                person_cccd: "231414142"
            },
            {
                person_name: "Nguyễn Văn C",
                person_cccd: "231414143"
            },
        ];
            var text = '';
            for (var i=0;i<data_person.length;i++){
                text+='<div class="person"><span class="person_name">'+data_person[i].person_name+'</span>,<span class="person_cccd"> '+data_person[i].person_cccd+'</span></div>'           
            }
            $(".list_person").html(text);
            console.log('load xong muc 1!!!!');
        }
        function load_muc_2(){
            var data_land = [
                {
                    land_number: "01",
                    land_map_number: "100m2",
                    land_area: "cac",
                    land_class: "abc",
                    land_use_date: "abc",
                    land_use: "abc",
                    land_address: "abc",
                    land_purpose: "abc"
                },
                {
                    land_number: "02",
                    land_map_number: "200m2",
                    land_area: "cac",
                    land_class: "abc",
                    land_use_date: "abc",
                    land_use: "abc",
                    land_address: "abc",
                    land_purpose: "abc"
                },
            ];

            var landCase = 2;//TH1: 1, TH2: 25  3
            var text = '';
            for (var i=0;i<data_land.length;i++){
                if(landCase == 1){
                    $(".land_first_case").show();
                    $(".land_second_case").hide();
                    text+='<div class="first_land_info"><p>a. Thừa đất số: <span class="land_number">'+data_land[i].land_number+'</span></p><p>tờ bản đồ số: <span class="land_map_number">'+data_land[i].land_map_number+'</span></p></div><div class="first_land_info"><p>b. Diện tích: <span class="land_area">'+data_land[i].land_area+'</span></p><p>c. Loại đất: <span class="land_class">'+data_land[i].land_class+'</span></p></div><p>d. Thời hạn sử dụng: <span class="land_use-date">'+data_land[i].land_use_date+'</span></p><p>đ. Hình thức sử dụng: <span class="land_use">'+data_land[i].land_use+'</span></p><p>e. Địa chỉ: <span class="land_address">'+data_land[i].land_address+'</span></p><p>g. Nguồn gốc sử dụng đất: <span class="land_purpose">'+data_land[i].land_purpose+'</span></p>'
                    $(".land_first_case").append(text);
                }
                else{
                    $(".land_first_case").hide();
                    $(".land_second_case").show();
                    text+='<tr><td><p>'+data_land[i].land_number+'</p></td><td><p>'+data_land[i].land_map_number+'</p></td><td><p>'+data_land[i].land_area+'</p></td><td><p>'+data_land[i].land_class+'</p></td><td><p>'+data_land[i].land_use_date+'</p></td><td><p>'+data_land[i].land_use+'</p></td><td><p>'+data_land[i].land_purpose+'</p></td><td><p>'+data_land[i].land_address+'</p></td></tr>'
                    $('.list_table_land').append(text);
                }
            }
            console.log('load xong muc 2!!!!');
        }
        function load_muc_3(){
            var data_asset = [
                {
                    asset_name: "01",
                    asset_area: "100m2",
                    asset_area_use: "01",
                    asset_number_floor: "100m2",
                    asset_structure: "01",
                    asset_level: "100m2",
                    asset_use: "01",
                    asset_use_time: "100m2"
                },
                {
                    asset_name: "02",
                    asset_area: "200m2",
                    asset_area_use: "02",
                    asset_number_floor: "200m2",
                    asset_structure: "02",
                    asset_level: "200m2",
                    asset_use: "02",
                    asset_use_time: "200m2"
                },
            ];
            var text_first = '';
            for(var i=0;i<data_asset.length;i++){
                text_first += '<div class="first_land_info"><p>a. Tên tài sản: <span class="asset_name">'+data_asset[i].asset_name+'</span></p><p>b. Diện tích xây dựng: <span class="asset_area">'+data_asset[i].asset_area+'</span></p></div><div class="first_land_info"><p>c. Diện tích sử dụng: <span class="asset_area_use">'+data_asset[i].asset_area_use+'</span></p><p>d. Số tầng: <span class="asset_number_floor">'+data_asset[i].asset_number_floor+'</span></p></div><div class="first_land_info"><p>đ. Kết cấu: <span class="asset_structure">'+data_asset[i].asset_structure+'</span></p><p>e. Cấp công trình: <span class="asset_level">'+data_asset[i].asset_level+'</span></p></div><div class="first_land_info"><p>g. Hình thức sử hữu: <span class="asset_use">'+data_asset[i].asset_use+'</span></p><p>h. Thời hạn sử dụng: <span class="asset_use_time">'+data_asset[i].asset_use_time+'</span></p></div><p>i. Địa chỉ: <span class="asset_address">'+data_asset[i].asset_name+'</span></p>'
            }          
            $(".land_info_asset").append(text_first);
            var assetCase = '1'; //1: TH1, 2:TH2
            var text = '';
            for (var i=0;i<data_asset.length;i++){
                if(assetCase == '1'){
                    $(".table_asset_first").show();
                    $(".table_asset_second").hide();

                    text+='<tr><td><p>'+data_asset[i].asset_name+'</p></td><td><p>'+data_asset[i].asset_area+'</p></td><td><p>'+data_asset[i].asset_area_use+'</p></td><td><p>'+data_asset[i].asset_number_floor+'</p></td><td><p>'+data_asset[i].asset_structure+'</p></td><td><p>'+data_asset[i].asset_level+'</p></td></tr>'
                    $(".table_asset_first").append(text);
                }
                else{
                    $(".table_asset_first").hide();
                    $(".table_asset_second").show();

                    text+='<tr><td><p>'+data_asset[i].asset_name+'</p></td><td><p>'+data_asset[i].asset_area+'</p></td><td><p>'+data_asset[i].asset_area_use+'</p></td><td><p>'+data_asset[i].asset_number_floor+'</p></td><td><p>'+data_asset[i].asset_use+'</p></td></tr>'
                    $(".table_asset_second").append(text);
                }
            }            
            console.log('load xong muc 3!!!!');
        }
        function load_muc_4(){
            var data_image = [
                {
                    image: "./img_re.png"
                },
            ];
            var text = '';
            for (var i=0;i<data_image.length;i++){
                text+='<img src="'+data_image[i].image+'" alt="">'
            }
            $(".image_land").html(text);
            console.log('load xong muc 4!!!!');
        }
        load_muc_4();
        load_muc_3();
        load_muc_2();
        load_muc_1();
    })
</script>
<!-- convert to docx -->
<script>
    $('#downloadBtn').on('click',function(){
        Export2Doc('main_content','mau_giay')
    });
    function Export2Doc(element, filename = '') {
            var meta= "Mime-Version: 1.0\nContent-Base: " + location.href + "\nContent-Type: Multipart/related; boundary=\"NEXT.ITEM-BOUNDARY\";type=\"text/html\"\n\n--NEXT.ITEM-BOUNDARY\nContent-Type: text/html; charset=\"utf-8\"\nContent-Location: " + location.href + "\n\n<!DOCTYPE html>\n<html>\n_html_</html>";
            var head= "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<style>\n_styles_\n</style>\n</head>\n";
            var html = document.getElementById(element).innerHTML ;
            var blob = new Blob(['\ufeff', html], {
                type: 'application/msword'
            });
            var  css = (
                   '<style>' +
                   'img {width:300px;}table {border-collapse: collapse; border-spacing: 0;}td{padding: 6px;}' +
                   '</style>'
                  );
            var options = { maxWidth: 624};
            var images = Array();
            var img = $(".image_land").find("img");
            
            for (var i = 0; i < img.length; i++) {
                // Calculate dimensions of output image
                var w = Math.min(img[i].width, options.maxWidth);
                var h = img[i].height * (w / img[i].width);
                // Create canvas for converting image to data URL
                var canvas = document.createElement("CANVAS");
                canvas.width = w;
                canvas.height = h;
                // Draw image to canvas
                var context = canvas.getContext('2d');
                context.drawImage(img[i], 0, 0, w, h);
                // Get data URL encoding of image
                var uri = canvas.toDataURL("image/jpg");
                $(img[i]).attr("src", img[i].src);
                img[i].width = w;
                img[i].height = h;
                // Save encoded image to array
                images[i] = {
                    type: uri.substring(uri.indexOf(":") + 1, uri.indexOf(";")),
                    encoding: uri.substring(uri.indexOf(";") + 1, uri.indexOf(",")),
                    location: $(img[i]).attr("src"),
                    data: uri.substring(uri.indexOf(",") + 1)
                };
            }

            // Prepare bottom of mhtml file with image data
            var imgMetaData = "\n";
            for (var i = 0; i < images.length; i++) {
                imgMetaData += "--NEXT.ITEM-BOUNDARY\n";
                imgMetaData += "Content-Location: " + images[i].location + "\n";
                imgMetaData += "Content-Type: " + images[i].type + "\n";
                imgMetaData += "Content-Transfer-Encoding: " + images[i].encoding + "\n\n";
                imgMetaData += images[i].data + "\n\n";
                
            }
            imgMetaData += "--NEXT.ITEM-BOUNDARY--";
// end Image Area %%

             var output = meta.replace("_html_", head.replace("_styles_", css) +  html) + imgMetaData;

            var url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(output);


            filename = filename ? filename + '.docx' : 'document.docx';


            var downloadLink = document.createElement("a");

            document.body.appendChild(downloadLink);

            if (navigator.msSaveOrOpenBlob) {
                navigator.msSaveOrOpenBlob(blob, filename);
            } else {

                downloadLink.href = url;
                downloadLink.download = filename;
                downloadLink.click();
            }

            document.body.removeChild(downloadLink);
        }
</script>
<!-- convert to pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js" ></script>
<script src="/af.min.js"></script>

 

<script type="text/javascript">
$(document).ready(function($) 
{ 

    $(document).on('click', '.btn_print', function(event) 
    {
        event.preventDefault();

        //credit : https://ekoopmans.github.io/html2pdf.js
        
        var element = document.getElementById('main_content'); 

        //easy
        //html2pdf().from(element).save();

        //custom file name
        // html2pdf().set({filename: 'mau_giay'+js.AutoCode()+'.pdf'}).from(element).save();


        //more custom settings
        var opt = 
        {
          margin:       1,
          filename:     'mau_giay'+js.AutoCode()+'.pdf',
          image:        { type: 'png/jpg/jpeg', quality: 0.98 },
          pagebreak: { mode: 'css', before: '#page2el' },
          html2canvas:  { scale: 2 },
          jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        // New Promise-based usage:
        html2pdf().set(opt).from(element).save();

         
    });



});
</script>
</html>